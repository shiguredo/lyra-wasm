<html>
  <head>
    <meta http-equiv="origin-trial" content="AgzZrbX4jBphRIVHd0mDLyV2c3zKrVzGq/wTUydsSAQqv2njX1U5BCFPiKHSvZsS0LXfsGFrZOqil6A9pu+4pQ0AAABgeyJvcmlnaW4iOiJodHRwOi8vbG9jYWxob3N0OjgwODAiLCJmZWF0dXJlIjoiVW5yZXN0cmljdGVkU2hhcmVkQXJyYXlCdWZmZXIiLCJleHBpcnkiOjE2NzUyOTU5OTl9">
  </head>
  <body>
    <script>

      var Module = {
          preRun: function() {
              FS.createPreloadedFile(
                  "/", "lyra_config.binarypb",
                  "https://raw.githubusercontent.com/google/lyra/main/model_coeffs/lyra_config.binarypb",
                  true, false);
              FS.createPreloadedFile(
                  "/", "soundstream_encoder.tflite",
                  "https://raw.githubusercontent.com/google/lyra/main/model_coeffs/soundstream_encoder.tflite",
                  true, false);
              FS.createPreloadedFile(
                  "/", "quantizer.tflite",
                  "https://raw.githubusercontent.com/google/lyra/main/model_coeffs/quantizer.tflite",
                  true, false);
              FS.createPreloadedFile(
                  "/", "lyragan.tflite",
                  "https://raw.githubusercontent.com/google/lyra/main/model_coeffs/lyragan.tflite",
                  true, false);
          },
          onRuntimeInitialized: async function() {
              let encoder = Module.LyraEncoder.create(48000, 1, 3200, false, "/");

              console.log("Created encoder");

              const samples = 960;
              let audioData = Module.newAudioData(samples);
              let i = 0;
              while (i < samples) {
                  audioData.set(i, Math.floor(Math.random() * 64000) - 32000);
                  i+=1;
              }
              const encoded = encoder.encode(audioData);
              console.log("Encoded");
              console.log(encoded);

              let decoder = Module.LyraDecoder.create(48000, 1, "/");
              console.log("Created decoder");

              const valid = decoder.setEncodedPacket(encoded);
              console.log("setEncodedPacket: " + valid);
              const decoded = decoder.decodeSamples(960);
              console.log("decoded");
              console.log(decoded);
          }
    };
    </script>
    <script src="bazel-bin/lyra-wasm/lyra.js"></script>

    hello
  </body>
</html>
